- name: Golang installation
  vars:
    version: 1.23.1
  block:
    - name: Set the correct Go download URL based on OS
      set_fact:
        go_url: >
          https://go.dev/dl/go{{ version }}.{{ 'linux-amd64' if ansible_os_family == 'Debian' else 'darwin-amd64' }}.tar.gz

    - name: Download Go tarball
      get_url:
        url: "{{ go_url }}"
        dest: "go{{ version }}.tar.gz"

    - name: Remove previous Go installation
      become: true
      command: rm -rf /usr/local/go

    - name: Extract and install Go
      become: true
      command: tar -C /usr/local -xzf go{{ version }}.tar.gz

    - name: Remove downloaded Go tarball
      command: rm -rf go{{ version }}.tar.gz*

    - name: Add Go binary path to profile
      lineinfile:
        path: ~/.profile
        line: 'export PATH=$PATH:/usr/local/go/bin:$GOPATH/bin'
        create: true
        state: present

    - name: Apply profile changes and verify Go installation
      shell: . ~/.profile && go version

  tags:
    - go
